<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Gaussian Copula Imputer" href="2.2_gaussian_copula_tutorial.html" /><link rel="prev" title="Threshold KNN‑Shapley Explainer" href="1.2_threshold_KNN_tutorial.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2023.07.26 -->
        <title>Gaussian Conditional Imputer - [SEP_SoSe2025 / Gruppe C] Game Theoretic Explainable Artificial Intelligence</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">[SEP_SoSe2025 / Gruppe C] Game Theoretic Explainable Artificial Intelligence</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/SEP_Logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">[SEP_SoSe2025 / Gruppe C] Game Theoretic Explainable Artificial Intelligence</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">shapiq_student</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of shapiq_student</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../shapiq_student.html">shapiq_student package</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1.1_1.3_basic_and_weighted_KNN_tutorial.html">KNN-Shapley Explainer Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.2_threshold_KNN_tutorial.html">Threshold KNN‑Shapley Explainer</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Gaussian Conditional Imputer</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.2_gaussian_copula_tutorial.html">Gaussian Copula Imputer</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_subset_finding_tutorial.html">Greedy Coalition Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_subset_finding_tutorial.html#beam-search-coalition-method">Beam Search Coalition Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_subset_finding_tutorial.html#beam-search-coalition-method-with-specified-beam-width">Beam Search Coalition Method with specified beam_width</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_subset_finding_tutorial.html#recursive-greedy-algorithm">Recursive greedy algorithm</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="gaussian-conditional-imputer">
<h1>Gaussian Conditional Imputer<a class="headerlink" href="#gaussian-conditional-imputer" title="Link to this heading">¶</a></h1>
<p>Willkommen zu diesem Tutorial über den Gaussian Conditional Imputer!
Hier zeigen wir, wie man <strong>Guassian Conditional Imputer</strong> in Python implementiert und anwendet.</p>
<section id="inhaltsverzeichnis">
<h2>Inhaltsverzeichnis<a class="headerlink" href="#inhaltsverzeichnis" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Was ist ein Gaussian Conditional Imputer?</p></li>
<li><p>Warum brauchen wir einen Gaussian Conditional Imputer?</p></li>
<li><p>Wie sieht die Implementierung aus?</p></li>
<li><p>Test und Visualisierung</p></li>
<li><p>Grenzen und Verbesserungsmöglichkeiten</p></li>
<li><p>Fazit</p></li>
</ol>
</section>
<section id="was-ist-ein-gaussian-conditional-imputer">
<h2>1. Was ist ein Gaussian Conditional Imputer?<a class="headerlink" href="#was-ist-ein-gaussian-conditional-imputer" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Ziel: Fehelnde Feature-Werte realistisch ergänzen (= <em>Imputation</em>)</p></li>
<li><p>Annahme: Die Daten folgen einer <strong>multivariaten Normalverteilung</strong></p></li>
<li><p>Grundidee: Wenn ein Teil der Features bekannt ist → andere aus der bedingten Verteilung berechnen</p></li>
<li><p>Formeln: besiert auf Gleichung (10) und (11) aus <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0004370221000539?via%3Dihub#fm0190">Aas et al. (2021)</a>, die die <strong>bedingte Erwartung</strong> und die <strong>bedingte Konvarianzmatrix</strong> liefern</p></li>
</ul>
</section>
<section id="warum-brauchen-wir-einen-gaussian-conditional-imputer">
<h2>2. Warum brauchen wir einen Gaussian Conditional Imputer?<a class="headerlink" href="#warum-brauchen-wir-einen-gaussian-conditional-imputer" title="Link to this heading">¶</a></h2>
<ul>
<li><p>Problem: Viele klassische Methoden (z.B. shap) nehmen Unabhängigkeit zwischen Features an</p>
<p>→ Fehlende Features werden zufällig oder mit Mittelwert ersetzt</p>
</li>
<li><p>Realität: Features sind oft <strong>korreliert</strong> (z.B. Einkommen und Bildung)<br />
→ Unabhängigkeitsannahme verzerrt die Shapley-Werte</p></li>
<li><p>Lösung mit Gaussian Conditional Imputer:
- Nutzt die bedingte multivariate Normalverteilung
- Sampelt realistische Werte, basierend auf den bekannten Features
- Führt zu präziseren, konsistenteren Shapley-Werten</p></li>
</ul>
</section>
<section id="wie-sieht-die-implementierung-aus">
<h2>3. Wie sieht die Implementierung aus?<a class="headerlink" href="#wie-sieht-die-implementierung-aus" title="Link to this heading">¶</a></h2>
<p>In diesem Abschnitt analysieren wir den Code <code class="docutils literal notranslate"><span class="pre">GaussianImputer</span></code>-Klasse Schritt für Schritt. Die Klasse erweitert das Imputer-Interface aus <code class="docutils literal notranslate"><span class="pre">shapiq</span></code> und verwendet die multivariate Normalverteilung, um fehlende Features zu ergänzen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Überprüfen der shapiq-Version</span>
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>shapiq<span class="w"> </span>overrides<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapiq</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shapiq version: </span><span class="si">{</span><span class="n">shapiq</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Überprüfen der shapiq-Version</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;pip install shapiq overrides &gt; /dev/null 2&gt;&amp;1&#39;</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">import</span><span class="w"> </span><span class="nn">shapiq</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;shapiq version: </span><span class="si">{</span><span class="n">shapiq</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">shapiq</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.3.1&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1"># approximator classes</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.approximator</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">SHAPIQ</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">SPEX</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">SVARM</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">SVARMIQ</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">InconsistentKernelSHAPIQ</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">KernelSHAP</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">KernelSHAPIQ</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">OwenSamplingSV</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">PermutationSamplingSII</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">PermutationSamplingSTII</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">PermutationSamplingSV</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">RegressionFBII</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="n">RegressionFSII</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="n">StratifiedSamplingSV</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="n">UnbiasedKernelSHAP</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="n">kADDSHAP</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.benchmark</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">BENCHMARK_CONFIGURATIONS</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="n">GAME_CLASS_TO_NAME_MAPPING</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>     <span class="n">run_benchmark_from_configuration</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span> <span class="c1"># dataset functions</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">shapiq</span><span class="o">/</span><span class="n">approximator</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">17</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.permutation.sv</span><span class="w"> </span><span class="kn">import</span> <span class="n">PermutationSamplingSV</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.regression</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">InconsistentKernelSHAPIQ</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">KernelSHAP</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">kADDSHAP</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">17</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">SPEX</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="c1"># contains all SV approximators</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="n">SV_APPROXIMATORS</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Approximator</span><span class="o">.</span><span class="vm">__class__</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">OwenSamplingSV</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">StratifiedSamplingSV</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>     <span class="n">SPEX</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="p">]</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">shapiq</span><span class="o">/</span><span class="n">approximator</span><span class="o">/</span><span class="n">sparse</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Sparse fourier-based approximators for higher-order interactions.&quot;&quot;&quot;</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sparse</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.spex</span><span class="w"> </span><span class="kn">import</span> <span class="n">SPEX</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="s2">&quot;SPEX&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="s2">&quot;Sparse&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">]</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">shapiq</span><span class="o">/</span><span class="n">approximator</span><span class="o">/</span><span class="n">sparse</span><span class="o">/</span><span class="n">base</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">get_args</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sparse_transform.qsft.qsft</span><span class="w"> </span><span class="kn">import</span> <span class="n">transform</span> <span class="k">as</span> <span class="n">sparse_fourier_transform</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sparse_transform.qsft.signals.input_signal_subsampled</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">SubsampledSignal</span> <span class="k">as</span> <span class="n">SubsampledSignalFourier</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sparse_transform.qsft.utils.general</span><span class="w"> </span><span class="kn">import</span> <span class="n">fourier_to_mobius</span> <span class="k">as</span> <span class="n">fourier_to_moebius</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sparse_transform</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sparse_transform.qsft</span><span class="w"> </span><span class="kn">import</span> <span class="n">qsft</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Package-level logger</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sparse_transform</span><span class="o">/</span><span class="n">qsft</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">qsft</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;qsft&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">]</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sparse_transform</span><span class="o">/</span><span class="n">qsft</span><span class="o">/</span><span class="n">qsft</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">RidgeCV</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">OrthogonalMatchingPursuit</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sparse_transform.qsft.utils.reconstruct</span><span class="w"> </span><span class="kn">import</span> <span class="n">singleton_detection</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="kn">from</span><span class="w"> </span><span class="nn">sparse_transform.qsft.utils.general</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">qary_vec_to_dec</span><span class="p">,</span> <span class="n">sort_qary_vecs</span><span class="p">,</span> <span class="n">calc_hamming_weight</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>                                                   <span class="n">dec_to_qary_vec</span><span class="p">,</span> <span class="n">qary_ints_low_order</span><span class="p">)</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">73</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span> <span class="c1"># `_distributor_init` allows distributors to run custom init code.</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span> <span class="c1"># For instance, for the Windows wheel, this is used to pre-load the</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span> <span class="c1"># vcomp shared library runtime for OpenMP embedded in the sklearn/.libs</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span> <span class="c1"># later is linked to the OpenMP runtime to make it possible to introspect</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="c1"># it and importing it first would fail if the OpenMP dll cannot be found.</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa: F401 E402</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>     <span class="n">__check_build</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>     <span class="n">_distributor_init</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span> <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">73</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">clone</span>  <span class="c1"># noqa: E402</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.utils._show_versions</span><span class="w"> </span><span class="kn">import</span> <span class="n">show_versions</span>  <span class="c1"># noqa: E402</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="n">_submodules</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span>     <span class="s2">&quot;calibration&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>     <span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span>     <span class="s2">&quot;compose&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> <span class="p">]</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">base</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">19</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span><span class="w"> </span><span class="nn">._config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config_context</span><span class="p">,</span> <span class="n">get_config</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">InconsistentVersionWarning</span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.utils._metadata_requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">_MetadataRequester</span><span class="p">,</span> <span class="n">_routing_enabled</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.utils._missing</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_scalar_nan</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.utils._param_validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_parameter_constraints</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">metadata_routing</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span><span class="w"> </span><span class="nn">._bunch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Bunch</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="kn">from</span><span class="w"> </span><span class="nn">._chunking</span><span class="w"> </span><span class="kn">import</span> <span class="n">gen_batches</span><span class="p">,</span> <span class="n">gen_even_slices</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># Make _safe_indexing importable from here for backward compat as this particular</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="c1"># helper is considered semi-private and typically very useful for third-party</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1"># libraries that want to comply with scikit-learn&#39;s estimator API. In particular,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># _safe_indexing was included in our public API documentation despite the leading</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="c1"># `_` in its name.</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="kn">from</span><span class="w"> </span><span class="nn">._indexing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">_safe_indexing</span><span class="p">,</span>  <span class="c1"># noqa: F401</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">resample</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">shuffle</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">_chunking</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">11</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.._config</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_config</span>
<span class="ne">---&gt; </span><span class="mi">11</span> <span class="kn">from</span><span class="w"> </span><span class="nn">._param_validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Interval</span><span class="p">,</span> <span class="n">validate_params</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="k">def</span><span class="w"> </span><span class="nf">chunk_generator</span><span class="p">(</span><span class="n">gen</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Chunk generator, ``gen`` into lists of length ``chunksize``. The last</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span><span class="sd">     chunk may have a length less than ``chunksize``.&quot;&quot;&quot;</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">_param_validation</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">17</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.sparse</span><span class="w"> </span><span class="kn">import</span> <span class="n">csr_matrix</span><span class="p">,</span> <span class="n">issparse</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.._config</span><span class="w"> </span><span class="kn">import</span> <span class="n">config_context</span><span class="p">,</span> <span class="n">get_config</span>
<span class="ne">---&gt; </span><span class="mi">17</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.validation</span><span class="w"> </span><span class="kn">import</span> <span class="n">_is_arraylike_not_scalar</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="k">class</span><span class="w"> </span><span class="nc">InvalidParameterError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Custom exception to be raised when the parameter of a class/method/function</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span><span class="sd">     does not have a valid type or value.</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span><span class="sd">     &quot;&quot;&quot;</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">validation</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">21</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="kn">from</span><span class="w"> </span><span class="nn">..</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_config</span> <span class="k">as</span> <span class="n">_get_config</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">from</span><span class="w"> </span><span class="nn">..exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataConversionWarning</span><span class="p">,</span> <span class="n">NotFittedError</span><span class="p">,</span> <span class="n">PositiveSpectrumWarning</span>
<span class="ne">---&gt; </span><span class="mi">21</span> <span class="kn">from</span><span class="w"> </span><span class="nn">..utils._array_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">_asarray_with_order</span><span class="p">,</span> <span class="n">_is_numpy_namespace</span><span class="p">,</span> <span class="n">get_namespace</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="kn">from</span><span class="w"> </span><span class="nn">..utils.deprecation</span><span class="w"> </span><span class="kn">import</span> <span class="n">_deprecate_force_all_finite</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="kn">from</span><span class="w"> </span><span class="nn">..utils.fixes</span><span class="w"> </span><span class="kn">import</span> <span class="n">ComplexWarning</span><span class="p">,</span> <span class="n">_preserve_dia_indices_dtype</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">_array_api</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">20</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span><span class="w"> </span><span class="nn">..externals</span><span class="w"> </span><span class="kn">import</span> <span class="n">array_api_extra</span> <span class="k">as</span> <span class="n">xpx</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="kn">from</span><span class="w"> </span><span class="nn">..externals.array_api_compat</span><span class="w"> </span><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np_compat</span>
<span class="ne">---&gt; </span><span class="mi">20</span> <span class="kn">from</span><span class="w"> </span><span class="nn">.fixes</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_version</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="c1"># TODO: complete __all__</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xpx&quot;</span><span class="p">]</span>  <span class="c1"># we import xpx here just to re-export it, need this to appease ruff</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">sklearn</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">fixes</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">20</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">optimize</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">20</span>     <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">pd</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="k">del</span> <span class="n">_hard_dependencies</span><span class="p">,</span> <span class="n">_dependency</span><span class="p">,</span> <span class="n">_missing_dependencies</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="c1"># numpy compat</span>
<span class="ne">---&gt; </span><span class="mi">22</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.compat</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_numpy_dev</span> <span class="k">as</span> <span class="n">_is_numpy_dev</span>  <span class="c1"># pyright: ignore # noqa:F401</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="kn">from</span><span class="w"> </span><span class="nn">pandas._libs</span><span class="w"> </span><span class="kn">import</span> <span class="n">hashtable</span> <span class="k">as</span> <span class="n">_hashtable</span><span class="p">,</span> <span class="n">lib</span> <span class="k">as</span> <span class="n">_lib</span><span class="p">,</span> <span class="n">tslib</span> <span class="k">as</span> <span class="n">_tslib</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">compat</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">25</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.compat._constants</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">IS64</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">PY39</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">PYPY</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="kn">import</span><span class="w"> </span><span class="nn">pandas.compat.compressors</span>
<span class="ne">---&gt; </span><span class="mi">25</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.compat.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>     <span class="n">is_numpy_dev</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span>     <span class="n">np_version_under1p21</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.compat.pyarrow</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="n">pa_version_under7p0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>     <span class="n">pa_version_under8p0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>     <span class="n">pa_version_under9p0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span>     <span class="n">pa_version_under11p0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span> <span class="k">def</span><span class="w"> </span><span class="nf">set_function_name</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">F</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">F</span><span class="p">:</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">compat</span><span class="o">/</span><span class="n">numpy</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span><span class="w"> </span><span class="sd">&quot;&quot;&quot; support numpy compatibility across versions &quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.util.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">Version</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># numpy versioning</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">_np_version</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">__version__</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># pyright: reportUnusedImport = false</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.util._decorators</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa:F401</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">Appender</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">Substitution</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">cache_readonly</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.core.util.hashing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># noqa:F401</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">hash_array</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">hash_pandas_object</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">util</span><span class="o">/</span><span class="n">_decorators</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">14</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">Any</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">Callable</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">Mapping</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">cast</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas._libs.properties</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache_readonly</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas._typing</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">F</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">T</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.util._exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_stack_level</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">homebrew</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">_libs</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">13</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="s2">&quot;NaT&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s2">&quot;NaTType&quot;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="s2">&quot;Interval&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">]</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas._libs.interval</span><span class="w"> </span><span class="kn">import</span> <span class="n">Interval</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">from</span><span class="w"> </span><span class="nn">pandas._libs.tslibs</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">NaT</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">NaTType</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">iNaT</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="p">)</span>

<span class="nn">File /opt/homebrew/lib/python3.11/site-packages/pandas/_libs/interval.pyx:1,</span> in <span class="ni">init pandas._libs.interval</span><span class="nt">()</span>

<span class="ne">ValueError</span>: numpy.dtype size changed, may indicate binary incompatibility. Expected 96 from C header, got 88 from PyObject
</pre></div>
</div>
</div>
</div>
<section id="imports-und-uberblick">
<h3>3.1 Imports und Überblick<a class="headerlink" href="#imports-und-uberblick" title="Link to this heading">¶</a></h3>
<p>Zuerst importieren wir die benötigten Pakete und bereiten die Klasse <code class="docutils literal notranslate"><span class="pre">GaussianImputer</span></code> vor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">multivariate_normal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapiq.games.imputer.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Imputer</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="konstruktur-init">
<h3>3.2 Konstruktur (<code class="docutils literal notranslate"><span class="pre">__init__</span></code>)<a class="headerlink" href="#konstruktur-init" title="Link to this heading">¶</a></h3>
<p>Die Klasse erbt von der abstrakten <code class="docutils literal notranslate"><span class="pre">Imputer</span></code>-Klasse im <code class="docutils literal notranslate"><span class="pre">shapiq</span></code>-Framework.<br />
Die Methode <code class="docutils literal notranslate"><span class="pre">__init__</span></code> initialisiert das Objekt mit Modell, Daten, dem zu erklärenden Punkt <code class="docutils literal notranslate"><span class="pre">x</span></code> und weiteren Parametern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">GaussianImputer</span><span class="p">(</span><span class="n">Imputer</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
        <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond_values</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="fit-methode">
<h3>3.3 Fit-Methode<a class="headerlink" href="#fit-methode" title="Link to this heading">¶</a></h3>
<p>Diese Methode speichert den Datenpunkt <code class="docutils literal notranslate"><span class="pre">x</span></code>, den wir erklären wollen.<br />
Dabei werden vorherige Zustände (<code class="docutils literal notranslate"><span class="pre">cond_idx</span></code>, <code class="docutils literal notranslate"><span class="pre">cond_values</span></code>) zurückgesetzt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GaussianImputer</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond_values</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="hauptlogik-call">
<h3>3.4 Hauptlogik: <code class="docutils literal notranslate"><span class="pre">__call__()</span></code><a class="headerlink" href="#hauptlogik-call" title="Link to this heading">¶</a></h3>
<p>Diese Methode berechnet für jede gegebene Koalition (Subset von Features) eine erwartete Modellvorhersage. Dabei wird angenommen, dass manche Features (<code class="docutils literal notranslate"><span class="pre">1</span></code>) und andere unbekannt (<code class="docutils literal notranslate"><span class="pre">0</span></code>) sind.</p>
<p>Ablauf:</p>
<ol class="arabic simple">
<li><p>Bekannte Features (<code class="docutils literal notranslate"><span class="pre">1</span></code>) bleiben unverändert</p></li>
<li><p>Unbekannte Features (<code class="docutils literal notranslate"><span class="pre">0</span></code>) werden mithilfe der bedingten multivariaten Normalverteilung ergänzt</p></li>
<li><p>Die vervollständigten Datenpuntkte werden dem Modell übergeben</p></li>
<li><p>Das Modell sagt Vorhersagen für alle Stichproben voraus</p></li>
<li><p>Der empirische Mittelwert dieser Vorhersagen wird zurückgegeben</p></li>
</ol>
<p>-&gt; Damit approximiert diese Methode die Shapley-Funktionsauswertung
$$ v(S) = E[f(x) \mid x_s] $$, welche exakt auf Gleichung (2) aus Aas et al. (2021) basiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coalitions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">coalition</span> <span class="ow">in</span> <span class="n">coalitions</span><span class="p">:</span>
            <span class="c1"># 1: Indizes der bekannten (cond_idx) und fehlenden (target_idx) Features ermitteln</span>
            <span class="n">cond_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">coalition</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">target_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_players</span><span class="p">),</span> <span class="n">cond_idx</span><span class="p">)</span>

            <span class="c1"># Spezialfälle: leere Koalition oder alle Features bekannt</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cond_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">empty_prediction</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># 2: Werte der bekannten Features extrahieren</span>
            <span class="n">cond_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">cond_idx</span><span class="p">]</span>

            <span class="c1"># 3: Bedingte Samples aus der multivariaten Normalverteilung ziehen</span>
            <span class="n">samples</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_conditional_gaussian</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">cond_idx</span><span class="p">,</span>
                <span class="n">cond_values</span><span class="p">,</span>
                <span class="n">n_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_size</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_state</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># 4: Vorhersage mit dem Modell für alle Samples</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
            <span class="n">mean_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># 5: Mittelwert der Vorhersagen speichern</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_pred</span><span class="p">)</span>

        <span class="c1"># 6: Ergebnisse als Numpy-Array zurückgeben</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="der-kern-sample-conditional-gaussian">
<h3>3.5 Der Kern: <code class="docutils literal notranslate"><span class="pre">sample_conditional_gaussian()</span></code><a class="headerlink" href="#der-kern-sample-conditional-gaussian" title="Link to this heading">¶</a></h3>
<p>In dieser Methode wird die zentrale mathematische Idee des Gaussian Imputers umgesetzt. Wir berechnen die bedingte Verteilung der unbekannten Features
$x_{ \bar {S}}$, gegeben die bekannten Features $x_{{S}}$. Ziel ist es, Stichproben für die fehlenden Features zu generieren.</p>
<section id="schritt-1-erwartungswert-und-kovarianz-der-gesamtdaten-berechnen">
<h4>▶ Schritt 1: Erwartungswert und Kovarianz der Gesamtdaten berechnen<a class="headerlink" href="#schritt-1-erwartungswert-und-kovarianz-der-gesamtdaten-berechnen" title="Link to this heading">¶</a></h4>
<p>Wir gehen davon aus, dass alle Daten aus einer multivariaten Normalverteilung stammen.
Daher berechnen wir:</p>
<ul class="simple">
<li><p>den Erwartungswert $ \mu $</p></li>
<li><p>die Kovarianzmatrix $ \Sigma $</p></li>
</ul>
</section>
<section id="schritt-2-aufteilen-in-bekannte-s-und-unbekannte-bar-s-features">
<h4>▶ Schritt 2: Aufteilen in bekannte ($S$) und unbekannte ($\bar{S}$) Features<a class="headerlink" href="#schritt-2-aufteilen-in-bekannte-s-und-unbekannte-bar-s-features" title="Link to this heading">¶</a></h4>
<p>Indizes werden entsprechend getrennt.
Danach teilen wir auch den Erwartungswert $ \mu $ und die Kovarianzmatrix $ \Sigma $ in Teilmatrizen auf:</p>
<ul class="simple">
<li><p>$ \mu_S $, $ \mu_{\bar{S}}$</p></li>
<li><p>$ \Sigma_{SS} $, $ \Sigma_{\bar{S}\bar{S}} $, $ \Sigma_{\bar{S}S} $, $ \Sigma_{S\bar{S}} $</p></li>
</ul>
</section>
<section id="schritt-3-berechnung-der-bedingten-verteilung">
<h4>▶ Schritt 3: Berechnung der bedingten Verteilung<a class="headerlink" href="#schritt-3-berechnung-der-bedingten-verteilung" title="Link to this heading">¶</a></h4>
<p>Die Formeln stammen aus <a class="reference external" href="https://www.sciencedirect.com/science/article/pii/S0004370221000539?via%3Dihub#fm0190">Aas et al. (2021)</a>:</p>
<ul class="simple">
<li><p><strong>Gleichung (10)</strong>: Bedingter Erwartungswert
$$  \mu_{\bar{S} \mid S} = \mu_{\bar{S}} + \Sigma_{\bar{S}S} \Sigma_{SS}^{-1} (x_S^* - \mu_S) $$</p></li>
<li><p><strong>Gleichung (11)</strong>: Bedingte Kovarianzmatrix
$$  \Sigma_{\bar{S} \mid S} = \Sigma_{\bar{S}\bar{S}} - \Sigma_{\bar{S}S} \Sigma_{SS}^{-1} \Sigma_{S\bar{S}} $$</p></li>
</ul>
<p>Hinweis: Wir verwenden die Pseudoinserse (<code class="docutils literal notranslate"><span class="pre">np.linalg.pinv</span></code>), falls die Matrix nicht invertierbar ist.</p>
</section>
<section id="schritt-4-ziehen-von-stichproben">
<h4>▶ Schritt 4: Ziehen von Stichproben<a class="headerlink" href="#schritt-4-ziehen-von-stichproben" title="Link to this heading">¶</a></h4>
<p>Nun erzeugen wir Stichproben aus
$$ N(\mu_{\bar{S}|S}, \Sigma_{\bar{S}|S})
$$
Diese Samples repräsentieren plausible Werte für die fehlenden Features.</p>
</section>
<section id="ergebnis">
<h4>▶ Ergebnis:<a class="headerlink" href="#ergebnis" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">conditional_samples</span></code>: Die gesampelten Werte der fehlenden Features</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mu_cond</span></code>: Der berechnete Erwartungswert der bedingten Verteilung</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sigma_cond</span></code>: Die zugehörige Kovarianzmatrix</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sample_conditional_gaussian</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">cond_idx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">cond_values</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">cond_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">cond_values</span><span class="p">)</span>

    <span class="c1"># 1: Erwartungswert und Kovarianzmatrix</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sigma_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># 2: Aufteilen in bekannte (S) und unbekannte (S̄) Features</span>
    <span class="n">feature_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">target_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">feature_indices</span><span class="p">,</span> <span class="n">cond_idx</span><span class="p">,</span> <span class="n">assume_unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">mu_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">cond_idx</span><span class="p">)</span>  <span class="c1"># μ_S</span>
    <span class="n">mu_sbar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">target_idx</span><span class="p">)</span>  <span class="c1"># μ_{S̄}</span>

    <span class="c1"># Teilmatrizen aus der Kovarianzmatrix extrahieren</span>
    <span class="n">sigma_ss</span> <span class="o">=</span> <span class="n">sigma_full</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">cond_idx</span><span class="p">,</span> <span class="n">cond_idx</span><span class="p">)]</span>  <span class="c1"># Σ_{SS}</span>
    <span class="n">sigma_sbar_sbar</span> <span class="o">=</span> <span class="n">sigma_full</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">target_idx</span><span class="p">,</span> <span class="n">target_idx</span><span class="p">)]</span>  <span class="c1"># Σ_{S̄S̄}</span>
    <span class="n">sigma_sbar_s</span> <span class="o">=</span> <span class="n">sigma_full</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">target_idx</span><span class="p">,</span> <span class="n">cond_idx</span><span class="p">)]</span>  <span class="c1"># Σ_{S̄S}</span>
    <span class="n">sigma_s_sbar</span> <span class="o">=</span> <span class="n">sigma_sbar_s</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Σ_{SS̄}</span>

    <span class="c1"># 3: Berechnung der bedingten Verteilung</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">cond_values</span> <span class="o">-</span> <span class="n">mu_s</span>
    <span class="n">inv_sigma_ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">sigma_ss</span><span class="p">)</span>
    <span class="n">mu_cond</span> <span class="o">=</span> <span class="n">mu_sbar</span> <span class="o">+</span> <span class="n">sigma_sbar_s</span> <span class="o">@</span> <span class="n">inv_sigma_ss</span> <span class="o">@</span> <span class="n">delta</span>
    <span class="n">sigma_cond</span> <span class="o">=</span> <span class="n">sigma_sbar_sbar</span> <span class="o">-</span> <span class="n">sigma_sbar_s</span> <span class="o">@</span> <span class="n">inv_sigma_ss</span> <span class="o">@</span> <span class="n">sigma_s_sbar</span>

    <span class="c1"># 4: Ziehen von Stichproben aus der bedingten multivariaten Normalverteilung</span>
    <span class="n">conditional_samples</span> <span class="o">=</span> <span class="n">multivariate_normal</span><span class="p">(</span>
        <span class="n">mean</span><span class="o">=</span><span class="n">mu_cond</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">sigma_cond</span><span class="p">,</span> <span class="n">allow_singular</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="c1"># Sicherstellen, dass die Ausgabe 2D ist</span>
    <span class="k">if</span> <span class="n">conditional_samples</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">conditional_samples</span> <span class="o">=</span> <span class="n">conditional_samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">conditional_samples</span><span class="p">,</span> <span class="n">mu_cond</span><span class="p">,</span> <span class="n">sigma_cond</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="test-und-visualisierung">
<h2>4. Test und Visualisierung<a class="headerlink" href="#test-und-visualisierung" title="Link to this heading">¶</a></h2>
<section id="test-mit-kunstlichen-testdaten">
<h3>4.1 Test mit künstlichen Testdaten<a class="headerlink" href="#test-mit-kunstlichen-testdaten" title="Link to this heading">¶</a></h3>
<p>In diesem Abschnitt testen wir unsere Hauptmethode <code class="docutils literal notranslate"><span class="pre">sample_conditional_gaussian()</span></code> mit künstlich generierten Daten.</p>
<ul class="simple">
<li><p>Die multivariate Verteilung hat einen bekannten Erwartungswert und eine Kovarianzmatrix</p></li>
<li><p>Wir fixieren ein Feature und berechnen die bedingte Verteilung der restlichen Features</p></li>
<li><p>Dann vergleichen wir:</p>
<ul>
<li><p>empirisch berechneten Mittelwert der gesampelten Daten</p></li>
<li><p>mit dem theoretischen Erwartungswert</p></li>
</ul>
</li>
<li><p>Wenn die beide Werte (und auch die Kovarianzmatrix) gut übereinstimmen, zeigt das, dass unsere Implementierung korrekt ist.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dummy-Modell für den Test</span>
<span class="k">def</span><span class="w"> </span><span class="nf">dummy_model</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_sample_conditional_gaussian</span><span class="p">():</span>

    <span class="c1"># Testdaten</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">sample_data</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

    <span class="c1"># Index und Wert der bekannten Features</span>
    <span class="n">cond_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cond_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>
    <span class="n">n_samples</span> <span class="o">=</span> <span class="mi">10000</span>

    <span class="c1"># GaussianImputer mit Dummy-Modell initialisieren</span>
    <span class="n">imputer</span> <span class="o">=</span> <span class="n">GaussianImputer</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">dummy_model</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sample_data</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="n">n_samples</span>
    <span class="p">)</span>

    <span class="c1"># Bedingte Samples erzeugen / Erwartungswert + Kovarianz berechnen</span>
    <span class="n">samples</span><span class="p">,</span> <span class="n">mu_cond</span><span class="p">,</span> <span class="n">sigma_cond</span> <span class="o">=</span> <span class="n">sample_conditional_gaussian</span><span class="p">(</span>
        <span class="n">sample_data</span><span class="p">,</span> <span class="n">cond_idx</span><span class="p">,</span> <span class="n">cond_values</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
    <span class="p">)</span>

    <span class="c1"># Empirische Werte berechnen</span>
    <span class="n">empirical_mean</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">empirical_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">rowvar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Vergleiche mit den theoretischen Werten</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">empirical_mean</span><span class="p">,</span> <span class="n">mu_cond</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">empirical_cov</span><span class="p">,</span> <span class="n">sigma_cond</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bedingte Erwartungswerte:&quot;</span><span class="p">,</span> <span class="n">mu_cond</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Empirischer Mittelwert:&quot;</span><span class="p">,</span> <span class="n">empirical_mean</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; Differnez:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mu_cond</span> <span class="o">-</span> <span class="n">empirical_mean</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bedingte Kovarianzmatrix:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sigma_cond</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Empirische Kovarianzmatrix</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">empirical_cov</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&gt; Differenz:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sigma_cond</span> <span class="o">-</span> <span class="n">empirical_cov</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conditional Samples:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>

<span class="n">test_sample_conditional_gaussian</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bedingte Erwartungswerte: [0.40247896 0.24290748]
Empirischer Mittelwert: [0.39989483 0.25864618]
-&gt; Differnez: [0.00258413 0.0157387 ]

Bedingte Kovarianzmatrix:
 [[ 0.3634229  -0.08905025]
 [-0.08905025  0.73043497]]
Empirische Kovarianzmatrix
 [[ 0.35570637 -0.07859925]
 [-0.07859925  0.74182342]]
-&gt; Differenz:
 [[0.00771653 0.010451  ]
 [0.010451   0.01138845]]

Conditional Samples:
 [[ 1.1824208  -0.54311823]
 [-0.51215731  0.28431153]
 [ 1.4573317  -0.02911964]
 ...
 [-0.30062915  0.82558158]
 [-0.34799363 -0.15950655]
 [ 0.41051004  1.17349108]]
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p><strong>Interpretation</strong></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Bedingte</span> <span class="pre">Erwartungswerte</span></code></p>
<ul class="simple">
<li><p>Feature 0 = 0.5 -&gt; erwartete Durchschnittswerte für Feature 1 und 2</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Bedingte</span> <span class="pre">Kovarianzmatrix</span></code></p>
<ul class="simple">
<li><p>zwischen Feature 1 und 2</p></li>
<li><p>Gültig unter Bedingung: Feature 0 =  0.5</p></li>
<li><p>Zeigt Richtung und Stärke der Abhängigkeit zwischen den verbleibenden Features</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Conditional</span> <span class="pre">Samples</span></code></p>
<ul class="simple">
<li><p>Gesampelte Werte aus der bedingten Normalverteilung</p></li>
<li><p>Realistische Kombinationen von Feature 1 und 2 bei fixiertem Feature 0</p></li>
</ul>
<p>▶ Empirische Werte ≈ Theoretische Werte<br />
▶ Implementierung korrekt!</p>
</section>
<section id="visualisierung">
<h3>4.2 Visualisierung<a class="headerlink" href="#visualisierung" title="Link to this heading">¶</a></h3>
<p>Diese Visualisierung überprüft:</p>
<ol class="arabic simple">
<li><p>Ob die Stichproben wirklich der theoretischen bedingten Verteilung entsprechen</p></li>
<li><p>In der Praxis wird dies durch numerische Tests überprüft, z.B:</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stichproben erzeugen</span>
<span class="n">samples</span><span class="p">,</span> <span class="n">mu_cond</span><span class="p">,</span> <span class="n">sigma_cond</span> <span class="o">=</span> <span class="n">sample_conditional_gaussian</span><span class="p">(</span>
    <span class="n">sample_data</span><span class="p">,</span> <span class="n">cond_idx</span><span class="p">,</span> <span class="n">cond_values</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<span class="p">)</span>

<span class="c1"># Datenframe erzeugen</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Feature 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Feature 2&quot;</span><span class="p">])</span>

<span class="c1"># Stichproben als Streudiagramm</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Feature 1&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Feature 2&quot;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bedingte Samples&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mu_cond</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mu_cond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bedingter Erwartungswert&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># 95%-Kofidenzellipse aus der bedingten Kovarianz</span>
<span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">sigma_cond</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
<span class="n">vecs</span> <span class="o">=</span> <span class="n">vecs</span><span class="p">[:,</span> <span class="n">order</span><span class="p">]</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">*</span><span class="n">vecs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="n">ellipse</span> <span class="o">=</span> <span class="n">Ellipse</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="n">mu_cond</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="n">theta</span><span class="p">,</span>
                  <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95</span><span class="si">%-E</span><span class="s1">llipse der Kovarianz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">ellipse</span><span class="p">)</span>

<span class="c1"># Achsenbeschriftung, Titel, Legende, Layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Bedingte Verteilung von Feature 1 &amp; 2 | Feature 0 = 0.5&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Feature 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Feature 2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c96a835f0bebb745a6d9c93e4813b676037b3b9b7a87e829a0eff310b6892308.png" src="../_images/c96a835f0bebb745a6d9c93e4813b676037b3b9b7a87e829a0eff310b6892308.png" />
</div>
</div>
<blockquote>
<div><p><strong>Interpretation</strong></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">Bedingte</span> <span class="pre">Samples</span></code></p>
<ul class="simple">
<li><p>Stichproben aus der bedingten Verteilung von Feature 1 und 2</p></li>
<li><p>gegeben Feature 0 = 0.5</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Bedingter</span> <span class="pre">Erwartungswert</span></code></p>
<ul class="simple">
<li><p>Theoretisch berechneter bedingter Erwartungswert (<em>mu_cond</em>)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">95%-Ellipse</span> <span class="pre">der</span> <span class="pre">Kovarianz</span></code></p>
<ul class="simple">
<li><p>95%-Konfidenzregion, basierend auf der bedingten Kovarianzmatrix (<em>sigma_cond</em>)</p></li>
</ul>
<p>◼ Die Stichproben liegen gut innerhalb der Ellipse (basieren auf der Kovarianzstruktur)<br />
→ Die bedingte Kovarianz wurde unter der Gaußschen Annahme korrekt berücksichtigt.</p>
<p>◼ Die rote Mittelpunkt liegt nahe am Zentrum der Stichprobenverteilung.<br />
→ Der Imputer hat den bedingten Erwartungswert korrekt geschätzt.</p>
</section>
</section>
<section id="grenzen-und-verbesserungsmoglichkeiten">
<h2>5. Grenzen und Verbesserungsmöglichkeiten<a class="headerlink" href="#grenzen-und-verbesserungsmoglichkeiten" title="Link to this heading">¶</a></h2>
<p>Obwohl der Gaussian Conditional Imputer bei der Apporoximation von bedingten Verteilungen nützlich ist, hat er einige wichtige Einschränkungen:</p>
<blockquote>
<div><p>Starke Annahme der multivariate Normalverteilung</p>
</div></blockquote>
<p>Diese Annahme ist in realen Datensätzen selten erfüllt, insbesondere wenn die Verteilungen schief oder komplex sind.</p>
<blockquote>
<div><p>Fehlende Flexibilität bei nicht-linearen Abhängigkeiten</p>
</div></blockquote>
<p>Wenn die Abhängigkeiten nicht-linear oder asymmetrisch sind, ist das Modell nicht realistisch.</p>
<p>Um diese Einschränkungen zu überwinden, schlägt Aas et al. (2021) vor, die Feature-Abhängigkeiten explizit zu modellieren, ohne sich auf Normalverteilung zu verlassen. Die <strong>Gaussian Copula</strong> erlaubt es, die lineare Abhängigkeit beizubehalten, während gleichzeitig beliebige Marginalverteilungen (d.h. Form der einzelnen Features) erlaubt sind.</p>
</section>
<section id="fazit">
<h2>6. Fazit<a class="headerlink" href="#fazit" title="Link to this heading">¶</a></h2>
<p>Der <strong>Gaussian Conditional Imputer</strong> bietet uns ein einfaches und klares Paradigma, um fehlende Werte unter Annahme einer Normalverteilung zu ergänzen. Diese Methode funktioniert gut, wenn die Daten wirklich annährend normalverteilt sind.
In der Praxis sehen wir jedoch oft nicht-lineare Abhängigkeiten oder asymmetrische Verteilungen, die der Gaussian Imputer nicht gut abbilden kann.</p>
<p>Genau hier bietet der <strong>Gaussian Copula Conditional Imputer</strong> eine wichtige Verbesserung, weil er mehr Flexibilität bei der Modellierung von Abhängigkeiten und Randverteilungen ermöglicht.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="2.2_gaussian_copula_tutorial.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Gaussian Copula Imputer</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="1.2_threshold_KNN_tutorial.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Threshold KNN‑Shapley Explainer</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Gaussian Conditional Imputer</a><ul>
<li><a class="reference internal" href="#inhaltsverzeichnis">Inhaltsverzeichnis</a></li>
<li><a class="reference internal" href="#was-ist-ein-gaussian-conditional-imputer">1. Was ist ein Gaussian Conditional Imputer?</a></li>
<li><a class="reference internal" href="#warum-brauchen-wir-einen-gaussian-conditional-imputer">2. Warum brauchen wir einen Gaussian Conditional Imputer?</a></li>
<li><a class="reference internal" href="#wie-sieht-die-implementierung-aus">3. Wie sieht die Implementierung aus?</a><ul>
<li><a class="reference internal" href="#imports-und-uberblick">3.1 Imports und Überblick</a></li>
<li><a class="reference internal" href="#konstruktur-init">3.2 Konstruktur (<code class="docutils literal notranslate"><span class="pre">__init__</span></code>)</a></li>
<li><a class="reference internal" href="#fit-methode">3.3 Fit-Methode</a></li>
<li><a class="reference internal" href="#hauptlogik-call">3.4 Hauptlogik: <code class="docutils literal notranslate"><span class="pre">__call__()</span></code></a></li>
<li><a class="reference internal" href="#der-kern-sample-conditional-gaussian">3.5 Der Kern: <code class="docutils literal notranslate"><span class="pre">sample_conditional_gaussian()</span></code></a><ul>
<li><a class="reference internal" href="#schritt-1-erwartungswert-und-kovarianz-der-gesamtdaten-berechnen">▶ Schritt 1: Erwartungswert und Kovarianz der Gesamtdaten berechnen</a></li>
<li><a class="reference internal" href="#schritt-2-aufteilen-in-bekannte-s-und-unbekannte-bar-s-features">▶ Schritt 2: Aufteilen in bekannte ($S$) und unbekannte ($\bar{S}$) Features</a></li>
<li><a class="reference internal" href="#schritt-3-berechnung-der-bedingten-verteilung">▶ Schritt 3: Berechnung der bedingten Verteilung</a></li>
<li><a class="reference internal" href="#schritt-4-ziehen-von-stichproben">▶ Schritt 4: Ziehen von Stichproben</a></li>
<li><a class="reference internal" href="#ergebnis">▶ Ergebnis:</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#test-und-visualisierung">4. Test und Visualisierung</a><ul>
<li><a class="reference internal" href="#test-mit-kunstlichen-testdaten">4.1 Test mit künstlichen Testdaten</a></li>
<li><a class="reference internal" href="#visualisierung">4.2 Visualisierung</a></li>
</ul>
</li>
<li><a class="reference internal" href="#grenzen-und-verbesserungsmoglichkeiten">5. Grenzen und Verbesserungsmöglichkeiten</a></li>
<li><a class="reference internal" href="#fazit">6. Fazit</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=d45e8c67"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>